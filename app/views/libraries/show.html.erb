<h1> Available Books </h1>
<p> You are logged in as <%= current_user.name %></p>
<p><%if current_user.admin%>
  You have admin powers
  <%end%>
</p>

<p><%=  link_to "Back to homepage", root_path%>
</p>
<p> <% if current_user.publisher %>
  <%= link_to "Add a book to the library", "/libraries/books/create_book" %>
<% end%></p>

<%= form_tag "/logout", method: :delete do %>
<button>logout</button>
  <%end%>
</form>

<table class="table table-condensed table-striped table-hover">
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th>Genre</th>
      <th> Available to checkout  </th>
      <th> Return </th>
      <th>Due Date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% Library.first.books.each do |book| %>
      <tr>
        <td><span title="<%=book.tagline%>"><%= book.title %></span></td>
        <td><%= book.author%></td>
        <td><%= book.genre%></td>
        <td>
          <% if !book.checked_out? %>
            <%= form_tag "/books/#{book.id}", method: :patch do %>
              <button class="btn btn-default">Checkout</button>
              <% Checkout.create!(user_id: current_user.id, book_id: book.id)%>
            <% end %>
            <% end %>
          </td>
          <td>
            <%if book.checked_out?%>
            <%= form_tag "/books/return/#{book.id}", method: :patch do %>
            <button class="btn btn-default">Return</button>
          <% end %>
          <% end %>
        </td>
        <td> <%=book.due_date%> </td>
        <td> <% if current_user.editor %>
          <%= link_to "Edit Book", "/libraries/books/edit_book/#{book.id}" %>
        <% end%></p>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
